---
title: redis的内存淘汰策略
date: 2023-09-14 12:58:45
categories: 
- redis
tags: 
- 内存淘汰策略 
---

# Redis的内存淘汰策略

### 引言

Redis是一个基于内存的高性能非关系型数据库，主要的特点是高可用，速度快，分布式；在通常的开发中用作缓存来分担数据库的压力。一般情况下，当内存超出物理内存限制时，内存数据将与磁盘产生频繁交换(swap)，swap会导致redis性能急剧下降，对于访问量较大的情况下，swap的存取效率会让服务基本处于不可用的状态。  

在生产环境中，一般不允许redis出现swap行为，redis提供了 maxmemory 设置其最多可占用的内存空间。  

当redis使用的内存超出maxmemory时，此时已经没有多余可用的内存空间，新的数据将无法写入，redis提供了几种数据淘汰策略，用于清理数据，腾出空间以继续提供服务。

### 淘汰策略

1. noeviction

   可读不可写，即不会继续服务写请求，读请求可以继续进行。该策略不会是数据丢失，但由于生产的写请求不可用也同样无法让业务在进行下去，这种策略是默认的。

2. volatile-lru

   淘汰具有过期时间的key，最少使用的key优先淘汰，没有过期时间的key不会被淘汰，该策略可以保证持久化的数据不被丢失。

3. volatile-ttl

   与volatile-lru类似，二者区别是比较过期时间ttl的值，值越小的数据优先淘汰

4. volatile-random

   与2、3类似，区别是随机淘汰有过期时间的key，但不考虑使用频率和过期时间的长短

5. allkeys-lru

   与2类似，区别是该淘汰策略是淘汰redis中所有的key，不区分过期时间，但是区分使用频率。

6. 与 5 类似，范围是所有的key，但是不区分使用频率。

volatile开头的只会淘汰带有过期时间的key，allkeys则是所有的key，如果redis只是作为缓存使用，可以使用allkeys，如果有些数据是务必持久化的，则使用volatile。
